From c555acfa7a1830b9718f97a58aa6fbf68112da1e Mon Sep 17 00:00:00 2001
From: rany <ranygh@riseup.net>
Date: Fri, 12 May 2023 20:01:24 +0300
Subject: [PATCH] wifi: mt76: mt7915: add 256-QAM support in 2.4Ghz

Signed-off-by: rany <ranygh@riseup.net>
---
 mt7915/init.c | 13 +++++++++++++
 1 file changed, 13 insertions(+)

--- a/mt7915/init.c
+++ b/mt7915/init.c
@@ -404,15 +404,25 @@ mt7915_init_wiphy(struct mt7915_phy *phy
 		wiphy->txq_memory_limit = 32 << 20; /* 32 MiB */
 
 	if (phy->mt76->cap.has_2ghz) {
+		struct ieee80211_sta_vht_cap *vht_cap;
+
+		vht_cap = &phy->mt76->sband_2g.sband.vht_cap;
 		phy->mt76->sband_2g.sband.ht_cap.cap |=
 			IEEE80211_HT_CAP_LDPC_CODING |
 			IEEE80211_HT_CAP_MAX_AMSDU;
-		if (is_mt7915(&dev->mt76))
+		if (is_mt7915(&dev->mt76)) {
 			phy->mt76->sband_2g.sband.ht_cap.ampdu_density =
 				IEEE80211_HT_MPDU_DENSITY_4;
-		else
+			vht_cap->cap |=
+				IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_7991 |
+				IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK;
+		} else {
 			phy->mt76->sband_2g.sband.ht_cap.ampdu_density =
 				IEEE80211_HT_MPDU_DENSITY_2;
+			vht_cap->cap |=
+				IEEE80211_VHT_CAP_MAX_MPDU_LENGTH_11454 |
+				IEEE80211_VHT_CAP_MAX_A_MPDU_LENGTH_EXPONENT_MASK;
+		}
 	}
 
 	if (phy->mt76->cap.has_5ghz) {
